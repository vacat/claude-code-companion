# Claude Code Companion Docker配置文件
# 此配置文件专为Docker环境优化

# 服务器配置
server:
  host: "0.0.0.0"  # Docker容器内需要监听所有接口
  port: 8080

# 日志配置
logging:
  level: "info"
  file: "/app/logs/claude-code-companion.log"
  max_size_mb: 100
  max_backups: 5
  max_age_days: 30
  compress: true
  json_format: true  # Docker环境建议使用JSON格式便于日志收集

# 超时配置
timeouts:
  tls_handshake: "10s"
  response_header: "60s"
  idle_connection: "90s"
  health_check_timeout: "30s"

# 安全配置
security:
  csrf:
    enabled: true
    key: "your-csrf-secret-key-change-this"  # 生产环境请更改此密钥

# 端点配置示例
endpoints:
  - name: "anthropic-official"
    url: "https://api.anthropic.com/v1/messages"
    type: "anthropic"
    priority: 1
    enabled: true
    timeout: "120s"
    retry_attempts: 3
    auth_type: "bearer"
    auth_value: "${ANTHROPIC_API_KEY}"  # 从环境变量读取
    tags:
      - "official"
      - "claude"
    health_check:
      enabled: true
      path: "/v1/messages"
      interval: "60s"
      timeout: "30s"
      method: "POST"
      expected_status: [200, 400, 401]  # 401也是正常的，表示服务可用但需要认证

  # OpenAI兼容端点示例
  - name: "openai-compatible"
    url: "https://api.openai.com/v1/chat/completions"
    type: "openai"
    priority: 2
    enabled: false  # 默认禁用，需要时可启用
    timeout: "120s"
    retry_attempts: 3
    auth_type: "bearer"
    auth_value: "${OPENAI_API_KEY}"  # 从环境变量读取
    tags:
      - "openai"
      - "gpt"
    health_check:
      enabled: true
      path: "/v1/chat/completions"
      interval: "60s"
      timeout: "30s"
      method: "POST"
      expected_status: [200, 400, 401]

  # 自定义端点示例
  - name: "custom-endpoint"
    url: "http://localhost:11434/v1/chat/completions"
    type: "openai"
    priority: 3
    enabled: false  # 默认禁用
    timeout: "120s"
    retry_attempts: 2
    auth_type: "none"
    tags:
      - "local"
      - "custom"
    health_check:
      enabled: true
      path: "/v1/chat/completions"
      interval: "120s"
      timeout: "30s"
      method: "POST"
      expected_status: [200, 400, 404]

# 标签路由配置
tagging:
  enabled: true
  default_tags: ["default"]
  
  # 内置标签器配置
  builtin:
    - type: "header"
      header_name: "X-Model-Tag"
      enabled: true
    
    - type: "path"
      path_patterns:
        "/v1/chat/completions": ["chat"]
        "/v1/completions": ["completion"]
      enabled: true
    
    - type: "user_agent"
      patterns:
        "Claude*": ["claude-client"]
        "OpenAI*": ["openai-client"]
      enabled: true

# 模型重写配置
model_rewrite:
  enabled: true
  rules:
    "claude-3-haiku": "claude-3-haiku-20240307"
    "claude-3-sonnet": "claude-3-sonnet-20240229"
    "claude-3-opus": "claude-3-opus-20240229"
    "gpt-4": "gpt-4-turbo-preview"
    "gpt-3.5-turbo": "gpt-3.5-turbo-0125"

# 统计监控配置
statistics:
  enabled: true
  retention_hours: 168  # 7天
  aggregation_interval: "1h"

# 健康检查配置
health:
  check_interval: "60s"
  failure_threshold: 3
  recovery_threshold: 2
  timeout: "30s"

# Web管理界面配置
web:
  enabled: true
  admin_path: "/admin"
  static_cache_max_age: "1h"
  
# 数据库配置（SQLite）
database:
  path: "/app/logs/claude-code-companion.db"
  max_connections: 10
  connection_lifetime: "1h"